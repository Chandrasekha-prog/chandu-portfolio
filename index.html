<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f9fafb;
            --gray: #6b7280;
            --border: #e5e7eb;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 28px;
        }

        .logo h1 {
            font-size: 24px;
            font-weight: 700;
        }

        .tabs {
            display: flex;
            background: var(--light);
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 18px 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--gray);
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .tab:hover {
            background: rgba(37, 99, 235, 0.08);
        }

        .tab-content {
            display: none;
            padding: 30px;
            min-height: 500px;
        }

        .tab-content.active {
            display: block;
        }

        /* Tracker Tab */
        .tracker-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .tracker-card {
            background: var(--light);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
        }

        .status-badge {
            padding: 8px 15px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.15);
            color: var(--secondary);
        }

        .status-inactive {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .location-data {
            margin-top: 20px;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .data-label {
            color: var(--gray);
            font-weight: 500;
        }

        .data-value {
            font-weight: 600;
            color: var(--dark);
        }

        .btn {
            padding: 14px 28px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: var(--secondary);
            color: white;
        }

        .btn-success:hover {
            background: #0da271;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        #map {
            height: 400px;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 20px;
        }

        /* Dashboard Tab */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--primary);
        }

        .stat-card:nth-child(2) {
            border-left-color: var(--secondary);
        }

        .stat-card:nth-child(3) {
            border-left-color: var(--warning);
        }

        .stat-card:nth-child(4) {
            border-left-color: var(--danger);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--dark);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--gray);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .devices-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .devices-table th {
            background: var(--light);
            padding: 18px 20px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--border);
        }

        .devices-table td {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border);
        }

        .device-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 50px;
            font-size: 14px;
        }

        .online {
            background: rgba(16, 185, 129, 0.15);
            color: var(--secondary);
        }

        .offline {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .history-container {
            margin-top: 30px;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-top: 15px;
        }

        .history-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-time {
            font-weight: 600;
            color: var(--dark);
        }

        .history-location {
            color: var(--gray);
        }

        /* Settings Tab */
        .settings-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }

        .settings-menu {
            background: var(--light);
            border-radius: 15px;
            padding: 0;
            overflow: hidden;
        }

        .settings-item {
            padding: 20px;
            cursor: pointer;
            border-bottom: 1px solid var(--border);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .settings-item.active {
            background: white;
            color: var(--primary);
            font-weight: 600;
        }

        .settings-item:hover {
            background: rgba(37, 99, 235, 0.08);
        }

        .settings-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--secondary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            color: var(--gray);
            border-top: 1px solid var(--border);
            margin-top: 30px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tracker-container {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .devices-table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-map-marker-alt"></i>
                <h1>Location Tracker</h1>
            </div>
            <div>
                <span id="current-time" class="time-display">--:--:--</span>
            </div>
        </header>

        <div class="tabs">
            <div class="tab active" data-tab="tracker">
                <i class="fas fa-satellite"></i> Live Tracker
            </div>
            <div class="tab" data-tab="dashboard">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </div>
            <div class="tab" data-tab="history">
                <i class="fas fa-history"></i> History
            </div>
            <div class="tab" data-tab="settings">
                <i class="fas fa-cog"></i> Settings
            </div>
        </div>

        <!-- Tracker Tab -->
        <div class="tab-content active" id="tracker">
            <div class="tracker-container">
                <div class="tracker-card">
                    <div class="card-header">
                        <div class="card-title">Tracking Status</div>
                        <div id="tracking-status" class="status-badge status-inactive">
                            <i class="fas fa-circle"></i> Inactive
                        </div>
                    </div>
                    
                    <div class="location-data">
                        <div class="data-row">
                            <span class="data-label">Latitude</span>
                            <span id="latitude" class="data-value">--</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Longitude</span>
                            <span id="longitude" class="data-value">--</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Accuracy</span>
                            <span id="accuracy" class="data-value">-- meters</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Speed</span>
                            <span id="speed" class="data-value">-- km/h</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Altitude</span>
                            <span id="altitude" class="data-value">-- meters</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Last Update</span>
                            <span id="last-update" class="data-value">Never</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Battery</span>
                            <span id="battery-level" class="data-value">--%</span>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button id="start-tracking" class="btn btn-success">
                            <i class="fas fa-play"></i> Start Tracking
                        </button>
                        <button id="stop-tracking" class="btn btn-danger" disabled>
                            <i class="fas fa-stop"></i> Stop Tracking
                        </button>
                        <button id="share-location" class="btn btn-secondary">
                            <i class="fas fa-share"></i> Share Location
                        </button>
                    </div>
                </div>

                <div class="tracker-card">
                    <div class="card-header">
                        <div class="card-title">Device Information</div>
                    </div>
                    
                    <div class="location-data">
                        <div class="data-row">
                            <span class="data-label">Device ID</span>
                            <span id="device-id" class="data-value">--</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Platform</span>
                            <span id="platform" class="data-value">--</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Connection</span>
                            <span id="connection" class="data-value">--</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">User Agent</span>
                            <span id="user-agent" class="data-value">--</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Screen Size</span>
                            <span id="screen-size" class="data-value">--</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Memory</span>
                            <span id="memory" class="data-value">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card-title" style="margin-top: 30px;">Live Location Map</div>
            <div id="map"></div>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content" id="dashboard">
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Tracking Time</div>
                    <div class="stat-value" id="total-time">00:00:00</div>
                    <i class="fas fa-clock" style="color: var(--primary); font-size: 24px;"></i>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Distance Traveled</div>
                    <div class="stat-value" id="total-distance">0 km</div>
                    <i class="fas fa-road" style="color: var(--secondary); font-size: 24px;"></i>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Locations Recorded</div>
                    <div class="stat-value" id="locations-count">0</div>
                    <i class="fas fa-map-pin" style="color: var(--warning); font-size: 24px;"></i>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Current Speed</div>
                    <div class="stat-value" id="current-speed">0 km/h</div>
                    <i class="fas fa-tachometer-alt" style="color: var(--danger); font-size: 24px;"></i>
                </div>
            </div>

            <div class="card-title">Connected Devices</div>
            <table class="devices-table">
                <thead>
                    <tr>
                        <th>Device ID</th>
                        <th>Status</th>
                        <th>Last Seen</th>
                        <th>Location</th>
                        <th>Battery</th>
                    </tr>
                </thead>
                <tbody id="devices-list">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>

            <div class="history-container">
                <div class="card-title">Recent Locations</div>
                <div class="history-list" id="recent-locations">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div class="tab-content" id="history">
            <div class="tracker-card">
                <div class="card-header">
                    <div class="card-title">Location History</div>
                    <div class="btn-group" style="margin: 0;">
                        <button id="export-history" class="btn btn-secondary">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button id="clear-history" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Date Range</label>
                    <div style="display: flex; gap: 15px;">
                        <input type="date" id="start-date" class="form-control">
                        <input type="date" id="end-date" class="form-control">
                        <button id="filter-history" class="btn btn-primary">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                    </div>
                </div>

                <div id="history-chart" style="height: 300px; margin: 30px 0; background: var(--light); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--gray);">
                    Chart will appear here
                </div>

                <div class="history-list" id="full-history-list" style="max-height: 400px;">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
            <div class="settings-grid">
                <div class="settings-menu">
                    <div class="settings-item active" data-setting="general">
                        <i class="fas fa-sliders-h"></i> General Settings
                    </div>
                    <div class="settings-item" data-setting="privacy">
                        <i class="fas fa-shield-alt"></i> Privacy & Security
                    </div>
                    <div class="settings-item" data-setting="notifications">
                        <i class="fas fa-bell"></i> Notifications
                    </div>
                    <div class="settings-item" data-setting="sharing">
                        <i class="fas fa-share-alt"></i> Sharing
                    </div>
                    <div class="settings-item" data-setting="about">
                        <i class="fas fa-info-circle"></i> About
                    </div>
                </div>

                <div class="settings-content">
                    <!-- General Settings -->
                    <div id="general-settings" class="settings-panel">
                        <h3 style="margin-bottom: 25px; color: var(--dark);">General Settings</h3>
                        
                        <div class="form-group">
                            <label>Tracking Interval (seconds)</label>
                            <input type="range" id="tracking-interval" min="1" max="60" value="5" class="form-control">
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span>1s</span>
                                <span id="interval-value">5s</span>
                                <span>60s</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Location Accuracy</label>
                            <select id="accuracy-level" class="form-control">
                                <option value="high">High Accuracy (GPS)</option>
                                <option value="balanced">Balanced (Wi-Fi & Cell)</option>
                                <option value="low">Low Power (Cell only)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Background Tracking</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="background-tracking">
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                            <small style="color: var(--gray);">Allow tracking when app is in background</small>
                        </div>

                        <div class="form-group">
                            <label>Map Type</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="map-type" value="roadmap" checked> Roadmap
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="map-type" value="satellite"> Satellite
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="map-type" value="hybrid"> Hybrid
                                </label>
                            </div>
                        </div>

                        <button id="save-settings" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </div>

                    <!-- Other settings panels would go here -->
                </div>
            </div>
        </div>

        <footer>
            <p>Location Tracker &copy; 2024 | Use responsibly and respect privacy laws</p>
            <p style="font-size: 12px; margin-top: 5px;">This app works best on mobile devices with GPS</p>
        </footer>
    </div>

    <script>
        // Global variables
        let map = null;
        let marker = null;
        let watchId = null;
        let trackingInterval = 5000; // 5 seconds
        let locationsHistory = [];
        let totalDistance = 0;
        let trackingStartTime = null;
        let currentPosition = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
        });

        function initializeApp() {
            // Initialize map
            map = L.map('map').setView([0, 0], 2);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            // Load saved data from localStorage
            loadSavedData();
            
            // Update device info
            updateDeviceInfo();
            
            // Load mock devices for demo
            loadMockDevices();
            
            // Load mock history for demo
            loadMockHistory();
        }

        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    switchTab(tabId);
                });
            });

            // Settings menu
            document.querySelectorAll('.settings-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.settings-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    // In a real app, you would switch settings panels here
                });
            });

            // Tracking buttons
            document.getElementById('start-tracking').addEventListener('click', startTracking);
            document.getElementById('stop-tracking').addEventListener('click', stopTracking);
            document.getElementById('share-location').addEventListener('click', shareLocation);

            // Settings
            document.getElementById('tracking-interval').addEventListener('input', function() {
                document.getElementById('interval-value').textContent = this.value + 's';
                trackingInterval = this.value * 1000;
            });

            document.getElementById('save-settings').addEventListener('click', saveSettings);

            // History buttons
            document.getElementById('export-history').addEventListener('click', exportHistory);
            document.getElementById('clear-history').addEventListener('click', clearHistory);
            document.getElementById('filter-history').addEventListener('click', filterHistory);
        }

        function switchTab(tabId) {
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabId);
            });

            // Update active content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === tabId);
            });

            // Refresh map size when switching to tracker tab
            if (tabId === 'tracker' && map) {
                setTimeout(() => map.invalidateSize(), 100);
            }
        }

        function startTracking() {
            if (watchId) return;

            if (!navigator.geolocation) {
                alert('Geolocation is not supported by your browser');
                return;
            }

            // Request location permission
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    // Permission granted
                    trackingStartTime = new Date();
                    updateTrackingStatus(true);

                    // Start watching position
                    watchId = navigator.geolocation.watchPosition(
                        updateLocation,
                        handleLocationError,
                        {
                            enableHighAccuracy: document.getElementById('accuracy-level').value === 'high',
                            maximumAge: 30000,
                            timeout: 27000
                        }
                    );

                    // Update buttons
                    document.getElementById('start-tracking').disabled = true;
                    document.getElementById('stop-tracking').disabled = false;

                    // Start periodic updates for simulation
                    startPeriodicUpdates();
                },
                (error) => {
                    alert('Location access is required for tracking. Please enable location services.');
                    console.error('Geolocation error:', error);
                }
            );
        }

        function startPeriodicUpdates() {
            // For demo purposes, simulate movement when tracking
            if (window.demoInterval) clearInterval(window.demoInterval);
            
            window.demoInterval = setInterval(() => {
                if (currentPosition) {
                    // Simulate small movement for demo
                    const simulatedPosition = {
                        coords: {
                            latitude: currentPosition.coords.latitude + (Math.random() - 0.5) * 0.001,
                            longitude: currentPosition.coords.longitude + (Math.random() - 0.5) * 0.001,
                            accuracy: currentPosition.coords.accuracy,
                            altitude: currentPosition.coords.altitude,
                            speed: Math.random() * 10,
                            heading: Math.random() * 360
                        },
                        timestamp: Date.now()
                    };
                    
                    updateLocation(simulatedPosition);
                }
            }, trackingInterval);
        }

        function stopTracking() {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }
            
            if (window.demoInterval) {
                clearInterval(window.demoInterval);
                window.demoInterval = null;
            }
            
            updateTrackingStatus(false);
            
            // Update buttons
            document.getElementById('start-tracking').disabled = false;
            document.getElementById('stop-tracking').disabled = true;
        }

        function updateLocation(position) {
            currentPosition = position;
            const coords = position.coords;
            const timestamp = new Date(position.timestamp);

            // Update UI
            document.getElementById('latitude').textContent = coords.latitude.toFixed(6);
            document.getElementById('longitude').textContent = coords.longitude.toFixed(6);
            document.getElementById('accuracy').textContent = coords.accuracy ? `${Math.round(coords.accuracy)} meters` : '--';
            document.getElementById('speed').textContent = coords.speed ? `${(coords.speed * 3.6).toFixed(1)} km/h` : '--';
            document.getElementById('altitude').textContent = coords.altitude ? `${Math.round(coords.altitude)} meters` : '--';
            document.getElementById('last-update').textContent = timestamp.toLocaleTimeString();
            
            // Update dashboard
            document.getElementById('current-speed').textContent = coords.speed ? `${(coords.speed * 3.6).toFixed(1)} km/h` : '0 km/h';

            // Update battery level if available
            if ('getBattery' in navigator) {
                navigator.getBattery().then(battery => {
                    document.getElementById('battery-level').textContent = `${Math.round(battery.level * 100)}%`;
                });
            }

            // Update map
            updateMap(coords.latitude, coords.longitude);

            // Save to history
            saveToHistory(position);

            // Update distance
            if (locationsHistory.length > 1) {
                const prevLoc = locationsHistory[locationsHistory.length - 2];
                const distance = calculateDistance(
                    prevLoc.coords.latitude,
                    prevLoc.coords.longitude,
                    coords.latitude,
                    coords.longitude
                );
                totalDistance += distance;
                document.getElementById('total-distance').textContent = `${totalDistance.toFixed(2)} km`;
            }

            // Update tracking time
            if (trackingStartTime) {
                const elapsed = Math.floor((new Date() - trackingStartTime) / 1000);
                const hours = Math.floor(elapsed / 3600);
                const minutes = Math.floor((elapsed % 3600) / 60);
                const seconds = elapsed % 60;
                document.getElementById('total-time').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function updateMap(lat, lng) {
            const newLatLng = [lat, lng];
            
            if (!marker) {
                marker = L.marker(newLatLng).addTo(map)
                    .bindPopup('Your current location')
                    .openPopup();
            } else {
                marker.setLatLng(newLatLng);
            }
            
            map.setView(newLatLng, 15);
            
            // Add circle for accuracy
            if (currentPosition?.coords?.accuracy) {
                if (window.accuracyCircle) {
                    map.removeLayer(window.accuracyCircle);
                }
                window.accuracyCircle = L.circle(newLatLng, {
                    radius: currentPosition.coords.accuracy
                }).addTo(map);
            }
        }

        function handleLocationError(error) {
            console.error('Location error:', error);
            let message = 'Unknown error';
            
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    message = 'Location permission denied';
                    break;
                case error.POSITION_UNAVAILABLE:
                    message = 'Location information unavailable';
                    break;
                case error.TIMEOUT:
                    message = 'Location request timed out';
                    break;
            }
            
            alert(`Location Error: ${message}`);
            stopTracking();
        }

        function updateTrackingStatus(isActive) {
            const statusBadge = document.getElementById('tracking-status');
            if (isActive) {
                statusBadge.className = 'status-badge status-active';
                statusBadge.innerHTML = '<i class="fas fa-circle"></i> Active';
            } else {
                statusBadge.className = 'status-badge status-inactive';
                statusBadge.innerHTML = '<i class="fas fa-circle"></i> Inactive';
            }
        }

        function updateDeviceInfo() {
            document.getElementById('device-id').textContent = 
                localStorage.getItem('deviceId') || generateDeviceId();
            document.getElementById('platform').textContent = 
                navigator.platform || 'Unknown';
            document.getElementById('connection').textContent = 
                navigator.connection ? navigator.connection.effectiveType : 'Unknown';
            document.getElementById('user-agent').textContent = 
                navigator.userAgent.substring(0, 30) + '...';
            document.getElementById('screen-size').textContent = 
                `${window.screen.width} × ${window.screen.height}`;
            document.getElementById('memory').textContent = 
                navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'Unknown';
        }

        function generateDeviceId() {
            const id = 'device-' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('deviceId', id);
            return id;
        }

        function shareLocation() {
            if (!currentPosition) {
                alert('No location to share. Start tracking first.');
                return;
            }

            const coords = currentPosition.coords;
            const url = `https://www.google.com/maps?q=${coords.latitude},${coords.longitude}`;
            const message = `My current location: ${url}`;

            if (navigator.share) {
                navigator.share({
                    title: 'My Location',
                    text: message,
                    url: url
                });
            } else {
                navigator.clipboard.writeText(message).then(() => {
                    alert('Location copied to clipboard!');
                });
            }
        }

        function saveToHistory(position) {
            const locationData = {
                timestamp: position.timestamp,
                coords: {
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude,
                    accuracy: position.coords.accuracy,
                    speed: position.coords.speed
                }
            };

            locationsHistory.push(locationData);
            document.getElementById('locations-count').textContent = locationsHistory.length;

            // Save to localStorage
            saveHistoryToStorage();

            // Update recent locations
            updateRecentLocations();
        }

        function saveHistoryToStorage() {
            try {
                localStorage.setItem('locationHistory', JSON.stringify(locationsHistory));
                localStorage.setItem('totalDistance', totalDistance.toString());
            } catch (e) {
                console.error('Failed to save to localStorage:', e);
            }
        }

        function loadSavedData() {
            try {
                const savedHistory = localStorage.getItem('locationHistory');
                if (savedHistory) {
                    locationsHistory = JSON.parse(savedHistory);
                    document.getElementById('locations-count').textContent = locationsHistory.length;
                }

                const savedDistance = localStorage.getItem('totalDistance');
                if (savedDistance) {
                    totalDistance = parseFloat(savedDistance);
                    document.getElementById('total-distance').textContent = `${totalDistance.toFixed(2)} km`;
                }
            } catch (e) {
                console.error('Failed to load saved data:', e);
            }
        }

        function updateRecentLocations() {
            const container = document.getElementById('recent-locations');
            const recent = locationsHistory.slice(-5).reverse();
            
            container.innerHTML = recent.map(loc => `
                <div class="history-item">
                    <div>
                        <div class="history-time">${new Date(loc.timestamp).toLocaleTimeString()}</div>
                        <div class="history-location">${loc.coords.latitude.toFixed(4)}, ${loc.coords.longitude.toFixed(4)}</div>
                    </div>
                    <div>
                        ${loc.coords.accuracy ? `<span style="color: var(--gray); font-size: 14px;">±${Math.round(loc.coords.accuracy)}m</span>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = 
                now.toLocaleTimeString([], {hour12: false});
        }

        function saveSettings() {
            const settings = {
                trackingInterval: document.getElementById('tracking-interval').value,
                accuracyLevel: document.getElementById('accuracy-level').value,
                backgroundTracking: document.getElementById('background-tracking').checked,
                mapType: document.querySelector('input[name="map-type"]:checked').value
            };

            localStorage.setItem('trackerSettings', JSON.stringify(settings));
            alert('Settings saved successfully!');
        }

        function exportHistory() {
            const dataStr = JSON.stringify(locationsHistory, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `location-history-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function clearHistory() {
            if (confirm('Are you sure you want to clear all location history?')) {
                locationsHistory = [];
                totalDistance = 0;
                localStorage.removeItem('locationHistory');
                localStorage.removeItem('totalDistance');
                
                document.getElementById('locations-count').textContent = '0';
                document.getElementById('total-distance').textContent = '0 km';
                document.getElementById('recent-locations').innerHTML = '';
                document.getElementById('full-history-list').innerHTML = '';
                
                alert('History cleared successfully!');
            }
        }

        function filterHistory() {
            // Implementation for filtering history by date range
            alert('Filter functionality would be implemented here');
        }

        function loadMockDevices() {
            const devices = [
                { id: 'device-1', status: 'online', lastSeen: '2 minutes ago', location: '40.7128° N, 74.0060° W', battery: '85%' },
                { id: 'device-2', status: 'online', lastSeen: '5 minutes ago', location: '34.0522° N, 118.2437° W', battery: '42%' },
                { id: 'device-3', status: 'offline', lastSeen: '1 hour ago', location: '51.5074° N, 0.1278° W', battery: '15%' }
            ];

            const tbody = document.getElementById('devices-list');
            tbody.innerHTML = devices.map(device => `
                <tr>
                    <td>${device.id}</td>
                    <td><span class="device-status ${device.status}"><i class="fas fa-circle"></i> ${device.status}</span></td>
                    <td>${device.lastSeen}</td>
                    <td>${device.location}</td>
                    <td><span style="font-weight: 600; color: ${parseInt(device.battery) < 20 ? 'var(--danger)' : 'var(--dark)'}">${device.battery}</span></td>
                </tr>
            `).join('');
        }

        function loadMockHistory() {
            const container = document.getElementById('full-history-list');
            const mockHistory = Array.from({length: 10}, (_, i) => ({
                timestamp: Date.now() - (i * 3600000),
                coords: {
                    latitude: 40.7128 + (Math.random() - 0.5) * 0.1,
                    longitude: -74.0060 + (Math.random() - 0.5) * 0.1,
                    accuracy: Math.random() * 50
                }
            }));

            container.innerHTML = mockHistory.map(loc => `
                <div class="history-item">
                    <div>
                        <div class="history-time">${new Date(loc.timestamp).toLocaleString()}</div>
                        <div class="history-location">${loc.coords.latitude.toFixed(6)}, ${loc.coords.longitude.toFixed(6)}</div>
                    </div>
                    <div>
                        <span style="color: var(--gray); font-size: 14px;">±${Math.round(loc.coords.accuracy)}m</span>
                    </div>
                </div>
            `).join('');
        }

        // Service Worker for background tracking (simplified)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js').catch(err => {
                console.log('Service Worker registration failed:', err);
            });
        }
    </script>
</body>
</html>
